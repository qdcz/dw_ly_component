(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(o=typeof globalThis<"u"?globalThis:o||self,n((o.dw=o.dw||{},o.dw["uisankey-diagram"]={}),o.Vue))})(this,function(o,n){"use strict";const S=(t,s)=>(t.install=function(p){if(t){const h=t.name||t.__name;if(h||s){const d=s?`dw-${s}`:"dw-"+h.replace(/dw/gi,"").toLowerCase();p.component(d,t)}else console.error(t,s,!s)}},t),E=t=>Array.isArray(t);function P(t){const s=`vi-${t}`;return{n:d=>d?d.startsWith("-")?`${s}${d}`:`${s}_${d}`:s,classes:(...d)=>d.map(g=>{if(E(g)){const[f,i,u=null]=g;return f?i:u}return g})}}const D=function(t,s){for(let[p,h]of Object.entries(s.value))t.style.setProperty("--"+p,h)},R={mounted(t,s){D(t,s)},updated(t,s){D(t,s)},install(t){t.directive("Css",this)}},V={heightScroll:{type:Boolean,default:!1},height:{type:String,default:"500"},width:{type:String,default:"600"},backgroundImg:{type:Object,default:()=>({leftBackgroundImg:"https://cdnforspeed.oss-cn-beijing.aliyuncs.com/Img/demo%20icon/Group%201321316955.png",leftBackgroundImgActive:"https://cdnforspeed.oss-cn-beijing.aliyuncs.com/Img/demo%20icon/Group%201321316954.png",rightBackgroundImg:"https://cdnforspeed.oss-cn-beijing.aliyuncs.com/Img/demo%20icon/Group%201321316957.png",rightBackgroundImgActive:"https://cdnforspeed.oss-cn-beijing.aliyuncs.com/Img/demo%20icon/Group%201321316958.png"})},dynamicCss:{type:Object,default:()=>({"item-mar-t":"10","item-pad-tb":"2","item-color_act":"#260bd984","left-color":"#166947e4","left-fo-wei":"600","left-fo-size":"20","left-fo-fam":"monospace","left-pad-r":"30","left-pad-l":"10","right-color":"#166947e4","right-fo-weight":"600","right-fo-size":"16","right-fo-family":"monospace","right-pad-r":"2","right-pad-l":"44","left-color_hov":"#65de06ff","right-color_hov":"#fff","line-color":"#b9dffce4","line-color_act":"#fc0","line-color_hov":"#55b2f8e4","line-wid":"2","line-wid_hov":"4","line-wid_act":"4","ani-time":"2"})},modelValue:{type:Array,default:[{name:"刘一",id:Math.random()*1e7,type:"left",link:[1,5,7]},{name:"陈二",id:Math.random()*1e7,type:"left",link:[1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"张三",id:Math.random()*1e7,type:"left",link:[8,6]},{name:"李四",id:Math.random()*1e7,type:"left",link:[2,3,4]},{name:"王五",id:Math.random()*1e7,type:"left",link:[9]},{name:"赵六",id:Math.random()*1e7,type:"left",link:[10,11]},{name:"孙七",id:Math.random()*1e7,type:"left",link:[13]},{name:"周八",id:Math.random()*1e7,type:"left",link:[1,13]},{name:"吴九",id:Math.random()*1e7,type:"left",link:[5]},{name:"郑十",id:Math.random()*1e7,type:"left",link:[2]},{name:"可弹性拓展网盘",type:"right",id:1},{name:"智慧工单管理系统",type:"right",id:2},{name:"大数据中台",type:"right",id:3},{name:"ERP管理",type:"right",id:4},{name:"gis可视化系统",type:"right",id:5},{name:"矿业管理系统",type:"right",id:6},{name:"帝网集成中心",type:"right",id:7},{name:"人事档案管理中心",type:"right",id:8},{name:"营销系统3.0",type:"right",id:9},{name:"东湖小镇数字孪生",type:"right",id:10},{name:"大模型调用中心",type:"right",id:11},{name:"业务中心中台",type:"right",id:12},{name:"政务系统",type:"right",id:13}]}},{n:c}=P("sankey-diagram"),B=S(n.defineComponent({name:"sankeyDiagram",emits:["update:width","select"],directives:{css:R},props:V,setup(t,s){var H;const h="onUpdate:modelValue"in(((H=n.getCurrentInstance())==null?void 0:H.vnode.props)||{}),d=n.ref(null),g=n.ref(null),f=n.ref(null),i=n.reactive({activeDomsIds:[],isActive:!1,leftItemHeight:0,leftItemWidth:0,rightItemHeight:0,rightItemWidth:0,centerBoxWidth:0,linkData:[],svg_path_d:[],svg_path_ids:[]}),u=n.computed(()=>{const e=Object.assign(V.dynamicCss.default(),t.dynamicCss);return e["left-bg-image"]=`url(${t.backgroundImg.leftBackgroundImg})`,e["left-bg-image_active"]=`url(${t.backgroundImg.leftBackgroundImgActive})`,e["right-bg-image"]=`url(${t.backgroundImg.rightBackgroundImg})`,e["right-bg-image_active"]=`url(${t.backgroundImg.rightBackgroundImgActive})`,e}),y=n.computed({get(){return t.modelValue.filter(e=>e.type=="left")},set(e){h&&s.emit("update:modelValue",e)}}),M=n.computed({get(){return t.modelValue.filter(e=>e.type=="right")},set(e){h&&s.emit("update:modelValue",e)}}),w=(e="left",a,r)=>{t.modelValue.filter(l=>l.type==e).forEach((l,m)=>{let I=a,v=0,k=m*r+r/2;const _=Number(u.value["item-mar-t"]);m==0?v=k:v=k+_*m;const b=[I,v];i.linkData.push({id:l.id,position:b})})},O=()=>{let e=[],a=[];for(let r=0;r<y.value.length;r++){const l=y.value[r];if(l.link&&l.link.length>0&&i.linkData&&i.linkData.length>0)for(let m=0;m<l.link.length;m++){const I=l.link[m],v=i.linkData.filter($=>$.id==l.id)[0],k=i.linkData.filter($=>$.id==I)[0],_=`${0},${v.position[1]}`,b=`${k.position[0]},${k.position[1]}`,q=`M ${_} ${b}`;e.push(q),a.push(`${l.id},${I}`)}}return{list:e,ids:a}},T=()=>{n.nextTick(()=>{i.leftItemHeight=d.value.children[0].getBoundingClientRect().height,i.leftItemWidth=d.value.clientWidth,i.rightItemHeight=f.value.children[0].getBoundingClientRect().height,i.rightItemWidth=f.value.clientWidth,i.centerBoxWidth=g.value.clientWidth,w("left",i.leftItemWidth,i.leftItemHeight),w("right",i.centerBoxWidth,i.rightItemHeight);const{list:e,ids:a}=O();i.svg_path_d=e,i.svg_path_ids=a;let r=y.value.length,l=M.value.length;g.value.style.height=Math.max(i.rightItemHeight*l+u.value["item-mar-t"]*(l-1),i.leftItemHeight*r+u.value["item-mar-t"]*(r-1))+"px"})},W=()=>{const e={};return[...Array.from(d.value.children),...Array.from(g.value.children),...Array.from(f.value.children)].forEach(r=>{let l=r.getAttribute("data-id");l&&(e[l]=r)}),e};n.onMounted(()=>{T()});const G=function(e){const a=W();A(a),e.type=="left"?[...e.link,e.id].forEach(r=>{i.activeDomsIds.push(r),a[r].classList.add("active"),i.svg_path_ids.forEach(l=>{l==`${e.id},${r}`&&(i.activeDomsIds.push(l),a[l].classList.add("active"))})}):e.type=="right"&&(y.value.forEach(r=>{r.link&&r.link.length>0&&r.link.findIndex(l=>l==e.id)!=-1&&(i.activeDomsIds.push(r.id),a[r.id].classList.add("active"),i.svg_path_ids.forEach(l=>{l==`${r.id},${e.id}`&&(i.activeDomsIds.push(l),a[l].classList.add("active"))}),i.activeDomsIds.push(e.id),a[e.id].classList.add("active"))}),i.activeDomsIds.push(e.id)),s.emit&&s.emit("select",e)},A=e=>{e=e||W();let a=i.activeDomsIds.pop();for(;a;)e[a].classList.remove("active"),a=i.activeDomsIds.pop(),a&&e[a].classList.remove("active")};s.expose({clearAllActive:A});const L=()=>n.createVNode("ul",{class:c("left"),ref:d},[y.value.map(e=>N(e))]),C=()=>n.createVNode("ul",{class:c("right"),ref:f},[M.value.map(e=>N(e,"right"))]),N=(e,a="left")=>n.createVNode("li",{class:[c(`${a}__item`),t.heightScroll?"":"fullParent"],key:e.id,"data-id":e.id,onClick:G.bind(this,e)},[e.name]),j=e=>n.createVNode("svg",{class:c("center"),ref:g},[n.createVNode("defs",null,[n.createVNode("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%"},null)]),i.svg_path_d.map((a,r)=>z(a,i.svg_path_ids[r]))]),z=(e,a)=>n.createVNode("path",{class:c("center__line"),d:e,"data-id":a},null);return()=>n.withDirectives(n.createVNode("div",{class:c(),style:{height:t.heightScroll?t.height+"px":"auto",width:t.width+"px"}},[t.heightScroll?n.createVNode("div",{class:c("scroll-wrapper")},[n.createVNode("div",{class:c("scroll")},[L(),j(),C()])]):n.createVNode("div",{class:c("scroll")},[L(),j(),C()])]),[[n.resolveDirective("css"),u.value||{}]])}}),"sankey-diagram");o.SankeyDiagram=B,o.default=B,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
